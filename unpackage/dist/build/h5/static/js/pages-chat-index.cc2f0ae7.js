(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-chat-index"],{"7ff3":function(t,i,e){"use strict";var a,s=function(){var t=this,i=t.$createElement,e=t._self._c||i;return e("v-uni-view",{staticClass:"moyi-bg-a"},[e("cu-custom",{attrs:{bgColor:"moyi-bg-b moyi-te-a",isAbs:!0,isBack:!0}},[e("template",{attrs:{slot:"backText"},slot:"backText"}),e("template",{attrs:{slot:"content"},slot:"content"},[e("v-uni-view",{staticClass:"cu-avatar round sm ",style:"background-image:url("+t.chat.avatar+");"},[e("v-uni-image",{attrs:{src:t.chat.frame,mode:"widthFix"}})],1),e("v-uni-text",{staticClass:"margin-left-ss "},[t._v(t._s(t.chat.nickname))])],1)],2),e("v-uni-scroll-view",{staticClass:"moyi-bg-a",staticStyle:{height:"100vh","padding-bottom":"100rpx"},style:[{paddingTop:t.CustomBar+t.InputBottom+"px"}],attrs:{"scroll-y":!0,"scroll-top":t.scrollTop,"scroll-with-animation":t.scrollAnimation,"scroll-into-view":t.scrollToView,"upper-threshold":"50"}},[e("v-uni-view",{staticClass:"cu-chat"},[e("v-uni-view",{staticClass:"bg-gray cu-info round text-center "},[t._v("安全提示：如果聊天中涉及在转账及裸聊等请提高警惕，谨防诈骗，发现可疑请立即举报")])],1),t._l(t.record,(function(i,a){return e("v-uni-view",{key:a,staticClass:"cu-chat",attrs:{id:"msg"+i.id}},["tips"==i.type?[e("v-uni-view",{staticClass:"cu-info round text-center"},[t._v(t._s(i.value))])]:[i.from==t.userInfo.id?e("v-uni-view",{staticClass:"cu-item self"},[e("v-uni-view",{staticClass:"main"},["images"==i.type?e("v-uni-image",{attrs:{src:i.value,mode:"widthFix"}}):"voice"==i.type?e("v-uni-view",{staticClass:"content shadow"},[e("v-uni-text",{staticClass:"cuIcon-sound text-xxl padding-right-xl"})],1):e("v-uni-view",{staticClass:"content shadow text-value"},[e("v-uni-text",[t._v(t._s(i.value))])],1)],1),e("v-uni-view",{staticClass:"cu-avatar radius",style:"background-image:url("+t.userInfo.avatar+"),url("+t.base.avatar+");"})],1):e("v-uni-view",{staticClass:"cu-item"},[e("v-uni-view",{staticClass:"cu-avatar radius",style:"background-image:url("+t.chat.avatar+"),url("+t.base.avatar+");"}),e("v-uni-view",{staticClass:"main"},["images"==i.type?e("v-uni-image",{attrs:{src:i.value,mode:"widthFix"}}):"voice"==i.type?e("v-uni-view",{staticClass:"content shadow"},[e("v-uni-text",{staticClass:"cuIcon-sound text-xxl padding-right-xl"})],1):e("v-uni-view",{staticClass:"content shadow text-value"},[e("v-uni-text",[t._v(t._s(i.value))])],1)],1)],1)]],2)})),e("v-uni-view",{style:[{height:t.InputBottom+"px"}]})],2),e("v-uni-view",{staticClass:"cu-bar foot input moyi-bg-b moyi-te-a",style:[{bottom:t.InputBottom+"px"}]},[e("v-uni-view",{staticClass:"action"},[e("v-uni-text",{staticClass:"cuIcon-sound text-grey"})],1),e("v-uni-input",{staticClass:"solid-bottom",attrs:{"adjust-position":!1,focus:!1,maxlength:"300","cursor-spacing":"10"},on:{focus:function(i){arguments[0]=i=t.$handleEvent(i),t.InputFocus.apply(void 0,arguments)},blur:function(i){arguments[0]=i=t.$handleEvent(i),t.InputBlur.apply(void 0,arguments)}},model:{value:t.inputText,callback:function(i){t.inputText=i},expression:"inputText"}}),e("v-uni-view",{staticClass:"action"},[e("v-uni-text",{staticClass:"cuIcon-emojifill text-grey"})],1),e("v-uni-button",{staticClass:"cu-btn bg-green shadow",on:{click:function(i){arguments[0]=i=t.$handleEvent(i),t.sendBtn()}}},[t._v("发送")])],1)],1)},n=[];e.d(i,"b",(function(){return s})),e.d(i,"c",(function(){return n})),e.d(i,"a",(function(){return a}))},"94fd9":function(t,i,e){"use strict";var a=e("caf1"),s=e.n(a);s.a},b95a:function(t,i,e){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var a={data:function(){return{CustomBar:this.CustomBar,scrollAnimation:!1,scrollTop:0,scrollToView:"",InputBottom:0,inputText:"",base:{avatar:this.$config.avatar},userInfo:this.$common.userInfo(),user:{id:342,nickname:"半甜",gender:0,avatar:"https://image.aishencn.com/2020/03/18/164612564_10784128-user.jpg",frame:null},chat:{id:342,nickname:"半甜",gender:0,avatar:"https://image.aishencn.com/2020/03/18/164612564_10784128-user.jpg",frame:null},record:[]}},created:function(){},onLoad:function(){var t=this,i=this.$db.get("chat");this.chat=i,this.record=this.$common.getRecord(i.id),this.$nextTick((function(){this.scrollTop=99999})),uni.$on("socketMessage",(function(e){var a=e.data;switch(e.type){case"init":break;case"msg":if(a.to==i.id||a.form==i.id)switch(a.type){case"text":t.record.push(a),t.goViewId(a.id);break;case"tips":console.log("监听到提示消息"),t.record.push(a),t.goViewId(a.id);break;default:console.log("监听到未标记消息");break}else switch(a.type){case"text":t.$common.getUserInfo(a.form);break}break;case"response":if(a.to==i.id||a.form==i.id)for(var s=t.record,n=s.length-1;n>=0;n--)s[n].id==a.id&&(t.record[n].state=a.value,n=0);break;default:console.log(e.type+"数据不作处理");break}}))},methods:{sendBtn:function(){var t=this.inputText;console.log("this.chat.inputText",t),t&&(this.send(t),this.inputText="")},send:function(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"text",e={id:(new Date).getTime(),type:i,to:this.chat.user_id?this.chat.user_id:this.chat.id,from:this.userInfo.id,value:t,state:"Sending",time:(new Date).getTime()};this.$common.addRecord(this.chat.id,e),this.$common.addNewMessageList(this.chat.id,e.value),this.record.push(e),this.goViewId(e.id),console.log("发送数据",e),uni.sendSocketMessage({data:JSON.stringify(e)})},goViewId:function(t){var i=this;t&&this.$nextTick((function(){i.scrollToView="msg"+t}))},InputFocus:function(t){this.InputBottom=t.detail.height},InputBlur:function(t){this.InputBottom=0}},onUnload:function(){this.$common.readNewMessageList(this.chat.id)}};i.default=a},bc7c:function(t,i,e){"use strict";e.r(i);var a=e("b95a"),s=e.n(a);for(var n in a)"default"!==n&&function(t){e.d(i,t,(function(){return a[t]}))}(n);i["default"]=s.a},caf1:function(t,i,e){var a=e("cca2");"string"===typeof a&&(a=[[t.i,a,""]]),a.locals&&(t.exports=a.locals);var s=e("4f06").default;s("2527370e",a,!0,{sourceMap:!1,shadowMode:!1})},cca2:function(t,i,e){var a=e("24fb");i=a(!1),i.push([t.i,".cu-chat .cu-item[data-v-61719575]{padding:%?10?% %?30?%}",""]),t.exports=i},d4e7:function(t,i,e){"use strict";e.r(i);var a=e("7ff3"),s=e("bc7c");for(var n in s)"default"!==n&&function(t){e.d(i,t,(function(){return s[t]}))}(n);e("94fd9");var o,c=e("f0c5"),u=Object(c["a"])(s["default"],a["b"],a["c"],!1,null,"61719575",null,!1,a["a"],o);i["default"]=u.exports}}]);