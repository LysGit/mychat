(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/index/app"],{"4e2e":function(t,e,o){"use strict";(function(t){o("81aa"),o("921b");n(o("66fd"));var e=n(o("6e1a"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},"61dd":function(t,e,o){},"6e1a":function(t,e,o){"use strict";o.r(e);var n=o("b1bc"),a=o("c3da");for(var s in a)"default"!==s&&function(t){o.d(e,t,function(){return a[t]})}(s);o("d12b");var i,c=o("f0c5"),r=Object(c["a"])(a["default"],n["b"],n["c"],!1,null,null,null,!1,n["a"],i);e["default"]=r.exports},b1bc:function(t,e,o){"use strict";var n,a=function(){var t=this,e=t.$createElement,o=(t._self._c,t.__map(t.newMessageList,function(e,o){var n=t.timeToDate(e.tips.time);return{$orig:t.__get_orig(e),m0:n}}));t.$mp.data=Object.assign({},{$root:{l0:o}})},s=[];o.d(e,"b",function(){return a}),o.d(e,"c",function(){return s}),o.d(e,"a",function(){return n})},b5c7:function(t,e,o){"use strict";(function(t){var o;function n(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=(o={data:function(){return{touch:{style:"",index:0,startX:0,direction:"",X:0},emit:!1,webSocket:{socketOpen:!1,socketMsgQueue:[]},my:{},popup:{name:null},test:1,topBar:{style:"height:"+this.CustomBar+"px;padding-top:"+this.StatusBar+"px;",back:!1,title:this.$config.title},modal:{name:"msg",history:[]},base:{lessClass:"less-gradual-pink line-gradual text-gradual"},contacts:{list:[{uid:1,avatar:this.$config.logo,nickname:"默毅",state:"",user:{uid:1,avatar:this.$config.logo,nickname:"默毅",state:""}}]},userInfo:this.$common.userInfo(),userList:[],newMessageList:[],message:{count:0},pageState:!1,tab:{route:"message",list:[{label:this.$t("app").message,icon:"cuIcon-comment",icons:"cuIcon-commentfill",name:"message",count:98},{label:this.$t("app").contacts,icon:"cuIcon-friend",icons:"cuIcon-friendfill",name:"contacts"},{label:this.$t("app").my,icon:"cuIcon-people",icons:"cuIcon-peoplefill",name:"my"}]}}},methods:{ListTouchEnd:function(t){console.log("拖动结束",t),this.touch.X<-50?(console.log("拖动合格"),this.touch.style="transition: all .3s ease-in-out 0s;transform: translateX(-130px);"):(this.touch.style="transition: all .3s ease-in-out 0s;transform: translateX(0px);",console.log("拖动bu合格"))},ListTouchStart:function(t){console.log("开始拖动",t),this.touch.X=0,this.touch.style="transform: translateX(0px);",this.touch.startX=t.touches[0].pageX},ListTouchMove:function(t){console.log("正在拖动",t);var e=t.touches[0].pageX-this.touch.startX;e<0&&e>-130&&(this.touch.X=e,this.touch.style="transform: translateX("+(t.touches[0].pageX-this.touch.startX)+"px);")},openPopup:function(t){this.popup.name=t},hidePopup:function(){this.popup.name=null},reMessgaeList:function(){var t=this,e=0;this.newMessageList=this.$common.getNewMessageList(),this.newMessageList.forEach(function(o,n){e+=o.tips.count,e>99&&(t.message.count=e)}),this.message.count=e},test0:function(t){this.touch.index=t,console.log("test0")},test1:function(){console.log(),this.$common.addNewMessageList("1083")},test2:function(){this.$common.addNewMessageList("1074")},test3:function(){this.$common.addNewMessageList("1082")},test4:function(){this.$common.readNewMessageList("1082")},goBack:function(){},change:function(t){this.modal.name=t,this.tab.route=t},openChat:function(e){console.log("进入聊天界面开始启用监听"),this.emit=!0,this.$common.readNewMessageList(e),t.navigateTo({url:"chat?id="+e}),this.reMessgaeList()},timeToDate:function(t){t<=999999999&&(t*=1e3);var e=new Date(t),o=new Date;if(o.getYear()==e.getYear()){if(new Date(t).toDateString()===(new Date).toDateString()){var n=e.getHours(),a=e.getMinutes();return n<10&&(n="0"+n),a<10&&(a="0"+a),n+":"+a}return new Date(t+86400).toDateString()===(new Date).toDateString()?"昨天":e.getMonth()+1+"月"+e.getDate()+"日"}return e.getYear()+"年"+(e.getMonth()+1)+"月"}},created:function(){var e=this;t.onSocketMessage(function(o){try{if(o=JSON.parse(o.data),o.code)switch(o.type){case"init":break;case"msg":if(!o.data.to||o.data.to!=e.userInfo.id)return void console.log("未知来源消息？",o);switch(console.log("保存消息？",o.data),o.data.type){case"text":e.$common.addNewMessageList(o.data.form,o.data.value,o.data.type),e.reMessgaeList();break;default:break}e.emit&&t.$emit("Message",o.data),e.$refs["myMessage"].info(o.data.value),e.$common.addRecord(o.data.form,o.data);case"response":e.emit&&t.$emit("Response",o.data),e.$common.updateRecordState(o.data);break;case"ping":t.sendSocketMessage({data:JSON.stringify({type:"ping"})}),console.log("ping");break;default:break}}catch(n){console.log("格式化错误")}}),this.pageState=!0},onLoad:function(){var e=this;this.reMessgaeList(),t.connectSocket({url:this.$config.webSocket+"?id="+this.userInfo.id+"&token="+this.userInfo.token,method:"get",data:function(){return{x:"2222",y:"3333"}},header:{Accept:"application/json","Content-Type":"application/json"}}),t.onSocketOpen(function(t){console.log("WebSocket连接已打开！"),e.webSocket.socketOpen=!0}),t.onSocketError(function(t){e.$common.errorToShow("WebSocket连接打开失败，请检查！")}),this.$api.friendsList({},function(t){1!=t.code?e.$common.errorToShow(t.msg):(t.data.forEach(function(t,o){t.user.avatar=e.$common.CDN(t.user.avatar)}),e.contacts.list=t.data,t.data.forEach(function(t,o){e.$db.set("uid_"+t.user.id,t.user)}))})},onShow:function(){},onHide:function(){}},n(o,"onShow",function(){console.log("进入主页面以关闭监听发送"),this.emit=!1}),n(o,"computed",{i18n:function(){return this.$t("app")},style:function(){var t=this.CustomBar,e=this.StatusBar,o="height:".concat(t,"px;padding-top:").concat(e,"px;");return o}}),o);e.default=a}).call(this,o("543d")["default"])},c3da:function(t,e,o){"use strict";o.r(e);var n=o("b5c7"),a=o.n(n);for(var s in n)"default"!==s&&function(t){o.d(e,t,function(){return n[t]})}(s);e["default"]=a.a},d12b:function(t,e,o){"use strict";var n=o("61dd"),a=o.n(n);a.a}},[["4e2e","common/runtime","common/vendor"]]]);